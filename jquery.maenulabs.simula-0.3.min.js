(function(j,f){j.fn.equals=function(q){return this[0]==j(q)[0]};var b=false;var m=true;j.elementFromPoint=function(r,q){if(!document.elementFromPoint){return null}if(!b){b=true;var s=j(document).scrollTop();var t=j(document).scrollLeft();if(s>0){m=(document.elementFromPoint(0,s+j(window).height()-1)==null)}else{if(t>0){m=(document.elementFromPoint(t+j(window).width()-1,0)==null)}else{b=false}}}if(!m){r+=j(document).scrollLeft();q+=j(document).scrollTop()}return document.elementFromPoint(r,q)};j.fn.isParentOf=function(r){var q=j(r);while(q[0]&&!this.equals(q)){q=q.parent()}return !this.equals(r)&&this.equals(q)};function h(){}h.prototype.updateObservable=function(r,q){};function k(){this.observers=[]}k.prototype.updateObservers=function(q){for(var r=0;r<this.observers.length;r++){this.observers[r].updateObservable(this,q)}};k.prototype.addObserver=function(q){for(var r=0;r<this.observers.length;r++){var s=this.observers[r];if(s==q){return}}this.observers.push(q)};k.prototype.removeObserver=function(q){for(var r=0;r<this.observers.length;r++){var s=this.observers[r];if(s==q){this.observers.splice(r,1);return}}};function n(r){var q=j.extend({},{bubbles:true,cancelable:true},r);this.type=q.type;this.bubbles=q.bubbles;this.cancelable=q.cancelable}n.PHASE={CAPTURING:1,AT_TARGET:2,BUBBLING:3};function p(r){n.apply(this,[r]);var q=j.extend({},{view:window,detail:0},r);this.view=q.view;this.detail=q.detail}p.prototype=new n();p.prototype.constructor=p;function l(r){p.apply(this,[r]);var q=j.extend({},{screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:false,shiftKey:false,altKey:false,metaKey:false,button:j.simula.SimulaMouseEvent.BUTTON.LEFT,relatedTarget:document},r);this.screenX=q.screenX;this.screenY=q.screenY;this.clientX=q.clientX;this.clientY=q.clientY;this.ctrlKey=q.ctrlKey;this.shiftKey=q.shiftKey;this.altKey=q.altKey;this.metaKey=q.metaKey;this.button=q.button;this.relatedTarget=q.relatedTarget}l.prototype=new p();l.prototype.constructor=l;l.BUTTON={LEFT:0,MIDDLE:1,RIGHT:2};l.TYPE={CLICK:"click",DOWN:"mousedown",UP:"mouseup",OVER:"mouseover",OUT:"mouseout",MOVE:"mousemove"};function d(){k.apply(this);this.running=false}d.prototype=new k();d.prototype.constructor=d;d.prototype.finish=function(){this.running=false;this.updateObservers("finish")};d.prototype.execute=function(){if(this.isRunning()){throw new Error("Simulator is already running")}this.running=true};d.prototype.stop=function(){if(this.isRunning()){this.running=false;this.updateObservers("stop")}};d.prototype.isRunning=function(){return this.running};function a(q){d.apply(this);this.simulators=q;this.currentIndex=-1}a.prototype=new d();a.prototype.constructor=a;a.prototype.updateObservable=function(r,q){if(q!="finish"||this.currentIndex<0||this.currentIndex>=this.simulators.length||r!=this.simulators[this.currentIndex]){return}var s=this.simulators[this.currentIndex];s.removeObserver(this);if(this.currentIndex<this.simulators.length-1){this.proceed()}else{this.finish()}};a.prototype.finish=function(){this.currentIndex=-1;d.prototype.finish.apply(this)};a.prototype.execute=function(){d.prototype.execute.apply(this);if(this.simulators.length>0){this.proceed()}else{this.finish()}};a.prototype.stop=function(){if(this.isRunning()){var q=this.simulators[this.currentIndex];q.stop();this.currentIndex=-1}d.prototype.stop.apply(this)};a.prototype.proceed=function(){this.currentIndex++;var q=this.simulators[this.currentIndex];q.addObserver(this);q.execute()};function c(q){d.apply(this);this.time=q;this.timeoutId=null}c.prototype=new d();c.prototype.constructor=c;c.prototype.execute=function(){d.prototype.execute.apply(this);this.timeoutId=setTimeout(j.proxy(function(){this.finish()},this),this.time)};c.prototype.stop=function(){if(this.isRunning()){clearTimeout(this.timeoutId)}d.prototype.stop.apply(this)};function i(r,q){d.apply(this);this.$element=r;this.simulaEvent=q;this.listener=function(){};this.event=null}i.prototype=new d();i.prototype.constructor=i;i.prototype.buildEvent=function(){return null};i.prototype.addEventListener=function(){};i.prototype.removeEventListener=function(){};i.prototype.handleEvent=function(q){if(q==this.event){this.removeEventListener(q);this.listener=function(){};this.event=null;this.finish()}};i.prototype.dispatchEvent=function(q){};i.prototype.execute=function(){d.prototype.execute.apply(this);this.event=this.buildEvent();this.listener=j.proxy(function(q){this.handleEvent(q)},this);this.addEventListener();this.dispatchEvent()};function e(q,r){i.apply(this,[q,r])}e.prototype=new i();e.prototype.constructor=e;e.prototype.buildEvent=function(){var r=this.simulaEvent;var q=document.createEvent("MouseEvents");q.initMouseEvent(r.type,r.bubbles,r.cancelable,r.view,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.button,r.relatedTarget);return q};e.prototype.addEventListener=function(){this.$element.get(0).addEventListener(this.event.type,this.listener,false)};e.prototype.removeEventListener=function(){this.$element.get(0).removeEventListener(this.event.type,this.listener,false)};e.prototype.dispatchEvent=function(){this.$element.get(0).dispatchEvent(this.event)};var o=e;function g(q,r){d.apply(this);this.simulatorQueue=new a([]);this.$element=q;this.elementPosition=[r[0],r[1]]}g.prototype=new d();g.prototype.constructor=g;g.prototype.updateObservable=function(r,q){if(q!="finish"||r!=this.simulatorQueue){return}this.simulatorQueue.removeObserver(this);this.finish()};g.prototype.execute=function(){d.prototype.execute.apply(this);this.simulatorQueue.addObserver(this);this.simulatorQueue.execute()};g.prototype.wait=function(q){if(!q){q=50}this.simulatorQueue.simulators.push(new c(q));return this};g.prototype.mousemove=function(q,r){if(!r){r={}}if(!q){q=this.$element}this.simulatorQueue.simulators.push(new o(q,new l(j.extend({},r,{type:l.TYPE.MOVE,cancelable:false}))));return this};g.prototype.mouseover=function(q,r){if(!r){r={}}if(!q){q=this.$element}this.simulatorQueue.simulators.push(new o(q,new l(j.extend({},r,{type:l.TYPE.OVER}))));return this};g.prototype.mouseout=function(q,r){if(!r){r={}}if(!q){q=this.$element}this.simulatorQueue.simulators.push(new o(q,new l(j.extend({},r,{type:l.TYPE.OUT}))));return this};g.prototype.mousedown=function(q,r){if(!r){r={}}if(!q){q=this.$element}this.simulatorQueue.simulators.push(new o(q,new l(j.extend({button:l.BUTTON.LEFT},r,{type:l.TYPE.DOWN}))));return this};g.prototype.mouseup=function(q,r){if(!r){r={}}if(!q){q=this.$element}this.simulatorQueue.simulators.push(new o(q,new l(j.extend({button:l.BUTTON.LEFT},r,{type:l.TYPE.UP}))));return this};g.prototype.mouseclick=function(q,r){if(!r){r={}}if(!q){q=this.$element}this.simulatorQueue.simulators.push(new o(q,new l(j.extend({button:l.BUTTON.LEFT},r,{type:l.TYPE.CLICK}))));return this};g.prototype.move=function(v,w,D,C){var y=v[0]-this.elementPosition[0];var x=v[1]-this.elementPosition[1];if(!w){w=Math.sqrt(y*y+x*x)}if(!D){D={}}var r=[];var u=15;while(u<=w){r.push({wait:15,dPosition:[u/w*y,u/w*x]});u+=15}if(w%15!=0){r.push({wait:w%15,dPosition:[y,x]})}var A=[this.$element.offset().left+this.elementPosition[0],this.$element.offset().top+this.elementPosition[1]];for(var z=0;z<r.length;z++){var t=r[z];var s=A[0]+t.dPosition[0];var q=A[1]+t.dPosition[1];this.wait(t.wait);var B=j(j.elementFromPoint(s,q));if(C&&!this.$element.equals(B)){if(B.isParentOf(this.$element)||!this.$element.isParentOf(B)){this.mouseout(this.$element,j.extend({},D,{clientX:s,clientY:q,relatedTarget:B.get(0)}))}if(this.$element.isParentOf(B)||!B.isParentOf(this.$element)){this.mouseover(B,j.extend({},D,{clientX:s,clientY:q,relatedTarget:this.$element.get(0)}))}this.$element=B}this.mousemove(this.$element,j.extend({},D,{clientX:s,clientY:q}));this.elementPosition=[s-this.$element.offset().left,q-this.$element.offset().top]}return this};g.prototype.enter=function(r,v){if(!v){v={}}if(this.$element.isParentOf(r)){var u=[];r.parents().each(function(){u.push(j(this))});while(!u.pop().equals(this.$element)){}var q=u.pop()||r;var t=q.offset().left-this.$element.offset().left+q.width()/2;var s=q.offset().top-this.$element.offset().top+q.height()/2;this.move([t,s]);this.mouseover(q,j.extend({},v,{clientX:this.$element.offset().left+t,clientY:this.$element.offset().top+s,relatedTarget:this.$element.get(0)}));this.$element=q;this.elementPosition=[q.width()/2,q.height()/2];if(!this.$element.equals(r)){this.enter(r)}}else{this.leave(this.$element);this.enter(r)}return this};g.prototype.leave=function(q,t){if(!q){q=this.$element}if(!t){t={}}if(q.isParentOf(this.$element)||q.equals(this.$element)){var u=this.$element;var v=this.$element.parent();var s=v.width()/2-(u.offset().left-v.offset().left);var r=v.height()/2-(u.offset().top-v.offset().top);this.move([s,r]);this.mouseout(u,j.extend({},t,{clientX:u.offset().left+s,clientY:u.offset().top+r,relatedTarget:v.get(0)}));this.$element=v;this.elementPosition=[v.width()/2,v.height()/2];if(!this.$element.equals(q.parent())){this.leave(q)}}else{this.enter(q);this.leave(q)}return this};g.prototype.press=function(q,r){if(!q){q=this.$element}if(!r){r={}}if(!this.$element.equals(q)){this.enter(q)}this.mousedown(this.$element,j.extend({},r,{clientX:this.$element.offset().left+this.elementPosition[0],clientY:this.$element.offset().top+this.elementPosition[1]}));return this};g.prototype.release=function(q,r){if(!q){q=this.$element}if(!r){r={}}if(!this.$element.equals(q)){this.enter(q)}this.mouseup(this.$element,j.extend({},r,{clientX:this.$element.offset().left+this.elementPosition[0],clientY:this.$element.offset().top+this.elementPosition[1]}));return this};g.prototype.click=function(q,r){if(!q){q=this.$element}if(!r){r={}}this.press(q);this.wait(5);this.release(this.$element);this.wait(5);this.mouseclick(this.$element,j.extend({},r,{clientX:this.$element.offset().left+this.elementPosition[0],clientY:this.$element.offset().top+this.elementPosition[1]}));return this};j.simula={};j.simula.Observer=h;j.simula.Observable=k;j.simula.Simulator=d;j.simula.SimulatorQueue=a;j.simula.TimeSimulator=c;j.simula.EventSimulator=i;j.simula.SimulaEvent=n;j.simula.SimulaUIEvent=p;j.simula.SimulaMouseEvent=l;j.simula.MouseEventSimulator=o;j.simula.Simulation=g}(jQuery));