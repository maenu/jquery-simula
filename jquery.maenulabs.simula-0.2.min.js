(function(i,e){function g(){}g.prototype.updateObservable=function(p,o){};function j(){this.observers=[]}j.prototype.updateObservers=function(o){for(var p=0;p<this.observers.length;p++){this.observers[p].updateObservable(this,o)}};j.prototype.addObserver=function(o){for(var p=0;p<this.observers.length;p++){var q=this.observers[p];if(q==o){return}}this.observers.push(o)};j.prototype.removeObserver=function(o){for(var p=0;p<this.observers.length;p++){var q=this.observers[p];if(q==o){this.observers.splice(p,1);return}}};function l(p){var o=i.extend({},{bubbles:true,cancelable:true},p);this.type=o.type;this.bubbles=o.bubbles;this.cancelable=o.cancelable}l.PHASE={CAPTURING:1,AT_TARGET:2,BUBBLING:3};function n(p){l.apply(this,[p]);var o=i.extend({},{view:window,detail:0},p);this.view=o.view;this.detail=o.detail}n.prototype=new l();n.prototype.constructor=n;function k(p){n.apply(this,[p]);var o=i.extend({},{screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:false,shiftKey:false,altKey:false,metaKey:false,button:i.simula.SimulaMouseEvent.BUTTON.LEFT,relatedTarget:document},p);this.screenX=o.screenX;this.screenY=o.screenY;this.clientX=o.clientX;this.clientY=o.clientY;this.ctrlKey=o.ctrlKey;this.shiftKey=o.shiftKey;this.altKey=o.altKey;this.metaKey=o.metaKey;this.button=o.button;this.relatedTarget=o.relatedTarget}k.prototype=new n();k.prototype.constructor=k;k.BUTTON={LEFT:0,MIDDLE:1,RIGHT:2};k.TYPE={CLICK:"click",DOWN:"mousedown",UP:"mouseup",OVER:"mouseover",OUT:"mouseout",MOVE:"mousemove"};function c(){j.apply(this);this.running=false}c.prototype=new j();c.prototype.constructor=c;c.prototype.finish=function(){this.running=false;this.updateObservers("finish")};c.prototype.execute=function(){if(this.isRunning()){throw new Error("Simulator is already running")}this.running=true};c.prototype.stop=function(){if(this.isRunning()){this.running=false;this.updateObservers("stop")}};c.prototype.isRunning=function(){return this.running};function a(o){c.apply(this);this.simulators=o;this.currentIndex=-1}a.prototype=new c();a.prototype.constructor=a;a.prototype.updateObservable=function(p,o){if(o!="finish"||this.currentIndex<0||this.currentIndex>=this.simulators.length||p!=this.simulators[this.currentIndex]){return}var q=this.simulators[this.currentIndex];q.removeObserver(this);if(this.currentIndex<this.simulators.length-1){this.proceed()}else{this.finish()}};a.prototype.finish=function(){this.currentIndex=-1;c.prototype.finish.apply(this)};a.prototype.execute=function(){c.prototype.execute.apply(this);if(this.simulators.length>0){this.proceed()}else{this.finish()}};a.prototype.stop=function(){if(this.isRunning()){var o=this.simulators[this.currentIndex];o.stop();this.currentIndex=-1}c.prototype.stop.apply(this)};a.prototype.proceed=function(){this.currentIndex++;var o=this.simulators[this.currentIndex];o.addObserver(this);o.execute()};function b(o){c.apply(this);this.time=o;this.timeoutId=null}b.prototype=new c();b.prototype.constructor=b;b.prototype.execute=function(){c.prototype.execute.apply(this);this.timeoutId=setTimeout(i.proxy(function(){this.finish()},this),this.time)};b.prototype.stop=function(){if(this.isRunning()){clearTimeout(this.timeoutId)}c.prototype.stop.apply(this)};function h(p,o){c.apply(this);this.$element=p;this.simulaEvent=o;this.listener=function(){};this.event=null}h.prototype=new c();h.prototype.constructor=h;h.prototype.buildEvent=function(){return null};h.prototype.addEventListener=function(){};h.prototype.removeEventListener=function(){};h.prototype.handleEvent=function(o){if(o==this.event){this.removeEventListener(o);this.listener=function(){};this.event=null;this.finish()}};h.prototype.dispatchEvent=function(o){};h.prototype.execute=function(){c.prototype.execute.apply(this);this.event=this.buildEvent();this.listener=i.proxy(function(o){this.handleEvent(o)},this);this.addEventListener();this.dispatchEvent()};function d(o,p){h.apply(this,[o,p])}d.prototype=new h();d.prototype.constructor=d;d.prototype.buildEvent=function(){var p=this.simulaEvent;var o=document.createEvent("MouseEvents");o.initMouseEvent(p.type,p.bubbles,p.cancelable,p.view,p.detail,p.screenX,p.screenY,p.clientX,p.clientY,p.ctrlKey,p.altKey,p.shiftKey,p.metaKey,p.button,p.relatedTarget);return o};d.prototype.addEventListener=function(){this.$element.get(0).addEventListener(this.event.type,this.listener,false)};d.prototype.removeEventListener=function(){this.$element.get(0).removeEventListener(this.event.type,this.listener,false)};d.prototype.dispatchEvent=function(){this.$element.get(0).dispatchEvent(this.event)};var m=d;function f(o,p){c.apply(this);this.simulatorQueue=new a([]);this.$element=o;this.elementPosition=[p[0],p[1]]}f.prototype=new c();f.prototype.constructor=f;f.prototype.updateObservable=function(p,o){if(o!="finish"||p!=this.simulatorQueue){return}this.simulatorQueue.removeObserver(this);this.finish()};f.prototype.execute=function(){c.prototype.execute.apply(this);this.simulatorQueue.addObserver(this);this.simulatorQueue.execute()};f.prototype.wait=function(o){if(!o){o=50}this.simulatorQueue.simulators.push(new b(o));return this};f.prototype.mousemove=function(o,p){if(!p){p={}}if(!o){o=this.$element}this.simulatorQueue.simulators.push(new m(o,new k(i.extend({},p,{type:k.TYPE.MOVE,cancelable:false}))));return this};f.prototype.mouseover=function(o,p){if(!p){p={}}if(!o){o=this.$element}this.simulatorQueue.simulators.push(new m(o,new k(i.extend({},p,{type:k.TYPE.OVER}))));return this};f.prototype.mouseout=function(o,p){if(!p){p={}}if(!o){o=this.$element}this.simulatorQueue.simulators.push(new m(o,new k(i.extend({},p,{type:k.TYPE.OUT}))));return this};f.prototype.mousedown=function(o,p){if(!p){p={}}if(!o){o=this.$element}this.simulatorQueue.simulators.push(new m(o,new k(i.extend({button:k.BUTTON.LEFT},p,{type:k.TYPE.DOWN}))));return this};f.prototype.mouseup=function(o,p){if(!p){p={}}if(!o){o=this.$element}this.simulatorQueue.simulators.push(new m(o,new k(i.extend({button:k.BUTTON.LEFT},p,{type:k.TYPE.UP}))));return this};f.prototype.mouseclick=function(o,p){if(!p){p={}}if(!o){o=this.$element}this.simulatorQueue.simulators.push(new m(o,new k(i.extend({button:k.BUTTON.LEFT},p,{type:k.TYPE.CLICK}))));return this};f.prototype.move=function(t,u,B,A){var w=t[0]-this.elementPosition[0];var v=t[1]-this.elementPosition[1];if(!u){u=Math.sqrt(w*w+v*v)}if(!B){B={}}var p=[];var s=15;while(s<=u){p.push({wait:15,dPosition:[s/u*w,s/u*v]});s+=15}if(u%15!=0){p.push({wait:u%15,dPosition:[w,v]})}var y=[this.$element.offset().left+this.elementPosition[0],this.$element.offset().top+this.elementPosition[1]];for(var x=0;x<p.length;x++){var r=p[x];var q=y[0]+r.dPosition[0];var o=y[1]+r.dPosition[1];this.wait(r.wait);var z=i(i.elementFromPoint(q,o));if(A&&!this.$element.equals(z)){if(z.isParentOf(this.$element)||!this.$element.isParentOf(z)){this.mouseout(this.$element,i.extend({},B,{clientX:q,clientY:o,relatedTarget:z.get(0)}))}if(this.$element.isParentOf(z)||!z.isParentOf(this.$element)){this.mouseover(z,i.extend({},B,{clientX:q,clientY:o,relatedTarget:this.$element.get(0)}))}this.$element=z}this.mousemove(this.$element,i.extend({},B,{clientX:q,clientY:o}));this.elementPosition=[q-this.$element.offset().left,o-this.$element.offset().top]}return this};f.prototype.enter=function(p,t){if(!t){t={}}if(this.$element.isParentOf(p)){var s=[];p.parents().each(function(){s.push(i(this))});while(!s.pop().equals(this.$element)){}var o=s.pop()||p;var r=o.offset().left-this.$element.offset().left+o.width()/2;var q=o.offset().top-this.$element.offset().top+o.height()/2;this.move([r,q]);this.mouseover(o,i.extend({},t,{clientX:this.$element.offset().left+r,clientY:this.$element.offset().top+q,relatedTarget:this.$element.get(0)}));this.$element=o;this.elementPosition=[o.width()/2,o.height()/2];if(!this.$element.equals(p)){this.enter(p)}}else{this.leave(this.$element);this.enter(p)}return this};f.prototype.leave=function(o,r){if(!o){o=this.$element}if(!r){r={}}if(o.isParentOf(this.$element)||o.equals(this.$element)){var s=this.$element;var t=this.$element.parent();var q=t.width()/2-(s.offset().left-t.offset().left);var p=t.height()/2-(s.offset().top-t.offset().top);this.move([q,p]);this.mouseout(s,i.extend({},r,{clientX:s.offset().left+q,clientY:s.offset().top+p,relatedTarget:t.get(0)}));this.$element=t;this.elementPosition=[t.width()/2,t.height()/2];if(!this.$element.equals(o.parent())){this.leave(o)}}else{this.enter(o);this.leave(o)}return this};f.prototype.press=function(o,p){if(!o){o=this.$element}if(!p){p={}}if(!this.$element.equals(o)){this.enter(o)}this.mousedown(this.$element,i.extend({},p,{clientX:this.$element.offset().left+this.elementPosition[0],clientY:this.$element.offset().top+this.elementPosition[1]}));return this};f.prototype.release=function(o,p){if(!o){o=this.$element}if(!p){p={}}if(!this.$element.equals(o)){this.enter(o)}this.mouseup(this.$element,i.extend({},p,{clientX:this.$element.offset().left+this.elementPosition[0],clientY:this.$element.offset().top+this.elementPosition[1]}));return this};f.prototype.click=function(o,p){if(!o){o=this.$element}if(!p){p={}}this.press(o);this.wait(5);this.release(this.$element);this.wait(5);this.mouseclick(this.$element,i.extend({},p,{clientX:this.$element.offset().left+this.elementPosition[0],clientY:this.$element.offset().top+this.elementPosition[1]}));return this};i.simula={};i.simula.Observer=g;i.simula.Observable=j;i.simula.Simulator=c;i.simula.SimulatorQueue=a;i.simula.TimeSimulator=b;i.simula.EventSimulator=h;i.simula.SimulaEvent=l;i.simula.SimulaUIEvent=n;i.simula.SimulaMouseEvent=k;i.simula.MouseEventSimulator=m;i.simula.Simulation=f}(jQuery));